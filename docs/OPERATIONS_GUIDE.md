# 운영 전략 가이드 — 계정 · 프록시 · 봇 감지 대응

> 자동화 팜에서 가장 먼저 터지는 건 계정이다.
> 두 번째로 터지는 건 프록시다.
> 세 번째는 USB다.

---

## 1. 계정 관리

### 1.1 계정 라이프사이클

```
신규 생성 → 워밍업  → 활성 (미션 투입) → 쿨다운 → 활성 → ... → 밴
```

| 단계       | 기간                    | 활동                                       |
| ---------- | ----------------------- | ------------------------------------------ |
| **워밍업** | 활성상태 아닐 시 지속속 | 랜덤 시청만 (좋아요/댓글 금지), 1일 5~10회 |
| **활성**   | 지속                    | 미션 수행, 로테이션 적용                   |
| **쿨다운** | 10~30분                 | 활동 중지 (과도한 활동 후 자동 진입)       |
| **밴**     | 영구                    | 풀에서 제거, 보충 필요                     |

### 1.2 로테이션 규칙

| 설정           | 값                    | 설명                    |
| -------------- | --------------------- | ----------------------- |
| 연속 활동 시간 | **최대 4시간**        | 이후 자동 쿨다운 30분   |
| 일일 로테이션  | **기기당 100개 계정** | 4시간 × 3 = 12시간 커버 |

### 1.3 계정 풀 규모

```
기기 500대 × 기본 1개 = 500 활성 계정 필요
+ 워밍업 중: ~200개 (신규 투입 대기)
+ 쿨다운 여유: ~300개
+ 밴 예비: ~200개
───────────────────
총 필요: ~1,000개 계정


```

### 1.4 밴 감지 신호 (자동 처리)

| 신호                | 처리         | 구현                                 |
| ------------------- | ------------ | ------------------------------------ |
| reCAPTCHA / 캡차    | 2시간 쿨다운 | `youtube/verify.js` detectBotWarning |
| "비정상적인 트래픽" | 2시간 쿨다운 | 위와 동일                            |
| 로그인 실패 / 요구  | 30분 쿨다운  | 위와 동일                            |
| 계정 정지 알림      | 영구 밴 처리 | AccountService.markBanned            |
| 연속 3회 미션 실패  | 1시간 쿨다운 | 미구현 → 향후 추가                   |

---

## 2. 프록시 관리

### 2.1 프록시 요구사항

| 항목      | 권장                                                               |
| --------- | ------------------------------------------------------------------ |
| 총 수량   | **500대 ÷ 프록시당 최대 1기기 = 최소 500개**                       |
| 타입      | Residential / ISP 프록시 (데이터센터 프록시는 YouTube가 즉시 차단) |
| 지역 분산 | 한국 IP 위주, 최소 3개 ISP 분산                                    |
| 프로토콜  | SOCKS5 또는 HTTP                                                   |

### 2.2 헬스체크

| 항목        | 값                                       |
| ----------- | ---------------------------------------- |
| 체크 주기   | **5분** (config: proxy_check_interval)   |
| 실패 임계값 | **3회 연속 실패 → invalid 처리**         |
| 자동 교체   | invalid 시 미할당 프록시로 자동 로테이션 |

### 2.3 프록시 없이 테스트

PC에서는 프록시 없이도 기본 흐름 동작해야 함:

- `proxy-manager.js`에서 프록시 없으면 skip
- 프록시 문제와 로직 문제를 분리할 수 있어야 함

---

## 3. 봇 감지 대응

### 3.1 행동 패턴 다양화 (이미 구현됨)

| 랜덤화 항목    | 구현 위치                         | 범위                   |
| -------------- | --------------------------------- | ---------------------- |
| 시청 시간      | `watch.js` watchVideo             | 목표의 ±30%            |
| 액션 타이밍    | `flows.js` \_planActionTimings    | 20~95% 시점 랜덤       |
| 인간 행동      | `watch.js` simulateHumanBehavior  | 30% 확률, 5가지 행동   |
| 탭 좌표 오프셋 | `adb/helpers.js` jitterCoord      | ±4px 랜덤              |
| 액션 간 딜레이 | `adb/helpers.js` humanDelay       | 800~2500ms             |
| 성격 타입      | `yt-actions.js` PERSONALITY_TYPES | 4종 (passive~superfan) |

### 3.2 시간대 활동 분포 (이미 구현됨)

```
시간대별 동시 가동률:
  심야 0-5시:  50~55% (자연스러운 감소, 완전 중단 안 함)
  아침 6-8시:  70~80% (점진 상승)
  주간 9-18시: 90~100% (최대 가동)
  저녁 19-22시: 80~95%
  밤 23시:     65%
```

→ `orchestrator/scheduler.js` HOURLY_ACTIVITY에 정의됨

### 3.3 기기 지문(Fingerprint) 다양화

Galaxy S9 500대가 모두 동일한 User-Agent/설정이면 의심됨.

| 항목            | 현재        | 권장                         |
| --------------- | ----------- | ---------------------------- |
| YouTube 앱 버전 | 모두 동일   | 2~3개 버전 분산 유지         |
| 화면 밝기       | 최소 (절전) | 기기별 랜덤 (1~50)           |
| 볼륨            | 동일        | 기기별 랜덤                  |
| 언어 설정       | 모두 한국어 | 그대로 (한국 타겟이므로)     |
| 이더넷 vs LTE   | 이더넷만    | 가능하면 일부 LTE (SIM 필요) |

### 3.4 위험 행동 (절대 금지)

1. **모든 기기가 동시에 같은 영상 시청** → 즉시 감지
2. **같은 계정으로 1시간 내 10개 이상 영상 좋아요** → 밴
3. **댓글 내용 패턴 반복** → CommentGenerator로 매번 다른 내용 생성
4. **24시간 무중단 활동** → 심야 감소 커브 적용하지 말것
5. **프록시 없이 500대 동시 활동** → 같은 IP에서 대량 트래픽 = 즉시 차단

---

## 4. 모니터링 알림 기준

| 이벤트             | 조건                | 심각도 | 알림                  |
| ------------------ | ------------------- | ------ | --------------------- |
| PC Agent 다운      | 하트비트 3분 미수신 | 🔴     | 즉시                  |
| 기기 대량 오프라인 | 10대+ 동시 오프라인 | 🔴     | 즉시 (USB 허브 의심)  |
| 미션 실패율        | > 20% (최근 1시간)  | 🟡     | 5분 내                |
| 계정 밴 파동       | 5개+ 동시 밴        | 🔴     | 즉시 (전체 중지 고려) |
| Supabase 연결 끊김 | Realtime 구독 끊김  | 🟡     | 1분 내                |
| 디스크 부족        | 로그 폴더 > 5GB     | 🟡     | 일일 체크             |

---

## 5. 일일 운영 체크리스트

### 아침 (출근 시)

- [ ] 대시보드에서 5개 PC 전부 online 확인
- [ ] 어젯밤 미션 실패율 확인 (< 10% 정상)
- [ ] 계정 밴 수 확인 (5개 이상이면 원인 분석)
- [ ] 프록시 상태 확인 (invalid < 10%)

### 저녁 (퇴근 전)

- [ ] 오늘 미션 달성률 확인
- [ ] 로그 파일 크기 확인 (비정상 증가 없는지)
- [ ] 내일 등록할 영상 확인/등록

### 주간 (매주 월요일)

- [ ] 계정 풀 잔여량 확인 → 보충 필요 시 발주
- [ ] 프록시 만료/갱신 확인
- [ ] YouTube 앱 업데이트 확인 (resource-id 변경 여부)
- [ ] Supabase 사용량 확인 (DB 크기, API 호출 수)
