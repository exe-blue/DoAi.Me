---
description: Node PC Agent (agent/) 규칙
globs: agent/**/*
alwaysApply: false
---

# Agent 규칙

## 역할

- Supabase Realtime 구독 → tasks 테이블 변경 감지
- Xiaowei WebSocket (`ws://127.0.0.1:22222/`)로 명령 전송
- Heartbeat: Xiaowei list API → workers/devices UPSERT

## 환경

- `agent/.env.template` 참조. `.env`는 배포 시 각 노드PC에 수동 생성
- `WORKER_NAME`은 노드PC별 고유

## Xiaowei API

- `actionCreate`: 녹화된 Action 실행
- `autojsCreate`: JS 스크립트 실행
- `list`: 연결 디바이스 조회 (heartbeat)

## 파일

- `xiaowei-client.js`: WebSocket 연결 및 API 호출
- `supabase-sync.js`: Realtime 구독, DB 업데이트
- `task-executor.js`: 태스크 실행 로직
- `heartbeat.js`: 주기적 디바이스 상태 동기화
