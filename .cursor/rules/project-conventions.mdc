---
description: DoAi.Me 팀 공용 강제 최소 규칙 (아키텍처·보안·운영)
alwaysApply: false
---

# DoAi.Me 프로젝트 규칙 (강제 최소)

## 아키텍처

- **백엔드**: FastAPI ❌ 금지. Vercel API Routes (Serverless) 사용.
- **태스크**: Celery/Redis ❌ 금지. Supabase Realtime + Xiaowei.
- **디바이스 제어**: Xiaowei WebSocket API (`ws://127.0.0.1:22222/`).
- **API 구조**: `app/api/**/route.ts` (Next App Router).

## 보안

- `SUPABASE_SERVICE_ROLE_KEY`를 클라이언트 코드에 노출 금지.
- `.env` 실값 커밋 금지. 비밀은 환경변수/Secret Manager만.

## 문서

- `ARCHITECTURE.md`: Single Source of Truth. 변경 시 이 문서를 먼저 업데이트.

## Dev Container 단일 기준

- **단일 기준 환경은 Dev Container(Linux)이다.** 동일 브랜치를 Windows/WSL/Dev Container에서 번갈아 열지 말 것.
- 빌드/테스트/실행은 Dev Container에서 수행. 예외는 문서화.

## PR 금지 파일 (포함 시 실패로 간주)

- `**/logs/**`, `**/*.log`, `**/farm_logs/**`
- `*.bak`, `*.backup`, `_archive/**`
- 깨진 파일명: `C:scriptscmd.json` 등
- 정리 전: `git clean -nd` 미리보기. 삭제는 경로 제한 `git clean -fd -- <paths>` 만.

## EOL / Git

- EOL는 `.gitattributes` 기준. 대량 EOL 변경 시 단독 커밋만 (`git add --renormalize .`).
- main에서 직접 작업 금지. 작업은 브랜치 → `git fetch origin` → `git rebase origin/main` → `git push --force-with-lease`.

## 금지 (요약)

- FastAPI, Celery, Redis, uiautomator2 도입 금지.
- main 직접 push, `git push --force`(사용 시 `--force-with-lease`만).
