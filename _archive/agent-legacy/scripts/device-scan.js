const WS_URL='ws://127.0.0.1:22222/';let ws,responseResolve;function connect(){return new Promise(r=>{const W=require('ws');ws=new W(WS_URL);ws.on('open',()=>r());ws.on('message',d=>{if(responseResolve){const x=responseResolve;responseResolve=null;x(JSON.parse(d.toString()));}});})}function adbShell(s,c){return new Promise(r=>{responseResolve=r;ws.send(JSON.stringify({action:'adb_shell',devices:s,data:{command:c}}));setTimeout(()=>{if(responseResolve){responseResolve=null;r({data:'TIMEOUT'});}},10000);})}function extract(r){if(!r)return'';if(typeof r==='string')return r;if(r.data&&typeof r.data==='string')return r.data.trim();if(r.data&&r.data.result)return r.data.result.trim();if(r.msg)return r.msg.trim();return JSON.stringify(r);}async function scanDevice(serial){console.log('\n'+'='.repeat(60));console.log('device: '+serial);console.log('='.repeat(60));const checks=[{l:'모델',c:'getprop ro.product.model'},{l:'Android',c:'getprop ro.build.version.release'},{l:'SDK',c:'getprop ro.build.version.sdk'},{l:'wm size',c:'wm size'},{l:'wm density',c:'wm density'},{l:'자동회전',c:'settings get system accelerometer_rotation'},{l:'user_rotation',c:'settings get system user_rotation'},{l:'화면꺼짐(ms)',c:'settings get system screen_off_timeout'},{l:'밝기',c:'settings get system screen_brightness'},{l:'밝기자동',c:'settings get system screen_brightness_mode'},{l:'USB화면유지',c:'settings get global stay_on_while_plugged_in'},{l:'볼륨',c:'settings get system volume_music_speaker'},{l:'win_anim',c:'settings get global window_animation_scale'},{l:'trans_anim',c:'settings get global transition_animation_scale'},{l:'anim_dur',c:'settings get global animator_duration_scale'},{l:'시간대',c:'getprop persist.sys.timezone'},{l:'DND',c:'settings get global zen_mode'},{l:'배터리',c:'dumpsys battery | grep level'},{l:'충전',c:'dumpsys battery | grep status'},{l:'YT버전',c:'dumpsys package com.google.android.youtube | grep versionName | head -1'},{l:'ADBKeyboard',c:'pm list packages com.android.adbkeyboard'},{l:'현재키보드',c:'settings get secure default_input_method'},{l:'프록시',c:'settings get global http_proxy'},{l:'메모리',c:'cat /proc/meminfo | grep MemAvailable | head -1'}];for(const ch of checks){const res=await adbShell(serial,ch.c);const v=extract(res).substring(0,80);console.log('  '+ch.l.padEnd(20)+': '+(v||'(empty)'));}}async function main(){await connect();console.log('Connected');const lr=await new Promise(r=>{responseResolve=r;ws.send(JSON.stringify({action:'list'}));});const devs=lr.data||[];console.log(devs.length+' devices');for(const d of devs){const s=d.serial||d.serialNumber||d.id;if(s)await scanDevice(s);}ws.close();console.log('\nDone');}main().catch(console.error);
